flowchart TD
    Start[Record initial balance and timestamp] --> B[Transaction stream]
    

    B --> C{Balance change?}
    C -->|No| D{End of period?}
    D -->|No| B
    D -->|Yes| E[Calculate time-weighted average]
    
    C -->|Yes| I[Record updated balance and timestamp]
    
    E --> N[End]

    